<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Airtime, Icecast and pfSense</title>
     
    <link rel="stylesheet" href='/css/style.css'> 
    <script src="https://kit.fontawesome.com/9ebc75ba92.js" crossorigin="anonymous"></script>
</head>

<body>
    <header id="site-header">
    <div class="nav">
        <a href="https://mikeder.net/">Home</a>  
        <a href="/about/">Abouts</a> 
        <a href="/blog/">Blogs</a> 
        <a href="/projects/">Projects</a> 
        <a href="/synthesizers/">Synthesizers</a>  
    </div>
</header> 
<main id="content" class="content">
    <article class="content-chunk">
        <h1>Airtime, Icecast and pfSense</h1>
        <h5>14.05.2015 18:07</h5>
        <div class="container">
            <p>Taking another look streaming internet radio along with more robust firewall and DNS control. I found a real nice Open Source radio backend called <!-- raw HTML omitted -->Airtime<!-- raw HTML omitted --> that re-kindled the idea of running an internet radio stream. Getting Airtime installed took a few tries, eventually I decided to just use their easy-install script. One thing to note is that the server locale needs to be set to US-UTF8 before postgresql is installed, otherwise the airtime installer will complain that the database was made with the wrong format and will error out.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>airtime$ dpkg-reconfigure locales
</span></span><span style="display:flex;"><span><span style="color:#75715e"># select en_US-UTF8</span>
</span></span></code></pre></div><p>The Airtime <!-- raw HTML omitted -->installation<!-- raw HTML omitted --> took care of the Icecast server installation and configuration, once everything was up and running I converted it to a &ldquo;production&rdquo; setup:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># To convert a test installation into a production installation, you can run the command:</span>
</span></span><span style="display:flex;"><span>sudo dpkg-reconfigure airtime
</span></span><span style="display:flex;"><span><span style="color:#75715e"># The dkpg-reconfigure command will run through the configuration steps shown in the Automated installation chapter, so that you can set the correct hostnames and passwords for # # your production Airtime server.</span>
</span></span></code></pre></div><p>Once Airtime was installed I set about trying pfSense again. I wanted to figure out a way to route subdomains to the proper VM containers through a pfSense router/firewall. I also had to modify my network configuration a bit to separate the LAN in my house from the VM lan. To do this I created 3 bridges in Proxmox:</p>
<ul>
<li>vmbr0 - bound to port eth0, used for management (proxmox 192.168.1.2, pfSense 192.168.1.10)</li>
<li>vmbr1 - bound to port eth1, used for pfSense WAN interface (192.168.1.12)</li>
<li>vmbr2 - no port bound, used for VM network (all containers are assigned an interface on this bridge)</li>
</ul>
<p>After connecting the bridges and interfaces I set the pfSense WAN in the DMZ of my ASUS router, everything is forwarded to the firewall and handled with WAN rules.</p>
<p>Since pfSense runs on Freebsd I had to set it up in a KVM virtual machine instead of an OpenVZ container. Once installed I found that the Squid3 package could be configured to work as a reverse proxy, which would give me the subdomain mapping that I was looking for. After installing the Squid3 package I setup the web servers and mappings to point to the appropriate VM&rsquo;s, I also set up aliases for these VM&rsquo;s so I don&rsquo;t have to remember the IP for them as they now get DHCP from the VMLAN interface in pfSense.</p>
<p>Once the mappings were in place I set a few firewall rules so that HTTP and HTTPS requests were allowed to pass to the reverse proxy roughly following <!-- raw HTML omitted -->this tutorial.<!-- raw HTML omitted --> I still need to do some work on refining and cleaning up how these requests are handled because as it stands now all HTTP requests are forwarded to the blog server and all HTTPS requests are forwarded to the Airtime administration page, unless a specific port is defined. Not sure why this is happening because I defined specific endpoints to be available for the reverse proxy but oh well, its a start, for now I can access everything I need.</p>

        </div>
         
        <br>
        <div>
            <a href="javascript:history.back()">Go Back</a>
        </div>
    </article>
</main>
 




<div id="myModal" class="modal">
    <div class="modal-content">
        <img class="modal-pic" id="modalPic" onclick="closeModal()" style="max-width: 100%; max-height: 80vh; margin: auto;">
    </div>
    <button class="modal-close" onclick="closeModal()">X</button>
</div>

<script>
    
    function openModal(clicked_id) {
        var src = document.getElementById(clicked_id).src;
        if (src.includes("#")) {
            src = src.substring(0, src.indexOf("#"));
        };
        document.getElementById("modalPic").src = src;
        document.getElementById("myModal").style.display = "block";
        
        
        document.getElementById("site-header").style.display = "none";
        document.getElementById("content").style.display = "none";
        document.getElementById("site-footer").style.display = "none";
    }

    
    function closeModal() {
        
        document.getElementById("modalPic").src = "";
        document.getElementById("myModal").style.display = "none";
        
        document.getElementById("site-header").style.display = "block";
        document.getElementById("content").style.display = "block";
        document.getElementById("site-footer").style.display = "block";
    }
    closeModal()
</script>    

<footer id="site-footer">
    <p>
        &copy; 2022 <a href="https://mikeder.net/">mikeder.net</a> v:7ba9364</p>

    
    <a class="fab fa-bandcamp" style="font-size: 24px" href="https://bandcamp.com/mikeder" target="_blank"></a>
     
    <a class="fab fa-docker" style="font-size: 24px" href="https://hub.docker.com/u/mikeder" target="_blank"></a>
     
    <a class="fab fa-github" rel="me" style="font-size: 24px" href="https://github.com/mikeder" target="_blank"></a>
     
    <a class="fab fa-instagram" style="font-size: 24px" href="https://www.instagram.com/sqweebking/" target="_blank"></a>
     
    <a class="fab fa-soundcloud" style="font-size: 24px" href="https://soundcloud.com/sqweebking" target="_blank"></a>
     
    <a class="fab fa-youtube" style="font-size: 24px" href="https://www.youtube.com/user/synthatik" target="_blank"></a>
    
</footer>
</body>

</html>